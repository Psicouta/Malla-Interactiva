// script.js
const courses = {
  // tu definición anterior aquí...
};

const semesters = {
  "Semestre I": [
    "Introducción Al Campo Ocupacional",
    "Procesos Cognitivos Y Afectivos I",
    "Historización De La Psicología",
    "Fundamentos De Filosofía",
    "Taller De Análisis Y Comprensión De Textos En Ciencias Sociales",
    "Taller De Habilidades Interpersonales Para El Ejercicio Profesional (I)",
    "Inglés Instrumental"
  ],
  "Semestre II": [
    "Procesos Cognitivos Y Afectivos II",
    "Psicología Del Ciclo Vital: Infancia Y Niñez",
    "Psicobiologia",
    "Diversidad Y Derechos Humanos",
    "Gestión Del Conocimiento Y Uso De Tics",
    "Taller De Habilidades Interpersonales Para Ejercicio Profesional (II)"
  ],
  "Semestre III": [
    "Enfoques Psicológicos I",
    "Psicología Social 1 Cognición Social",
    "Psicología Del Ciclo Vital: Adolescencia Y Juventud",
    "Epistemología De Las Ciencias Sociales",
    "Alfabetización Estadística",
    "Taller De Comunicación Efectiva",
    "Inglés Instrumental Para Psicología"
  ],
  "Semestre IV": [
    "Enfoques Psicológicos II",
    "Psicología Social 2 Procesos Grupales",
    "Psicología Del Ciclo Vital: Adulto Y Adulto Mayor",
    "Introducción A La Investigación En Ciencias Sociales",
    "Problemáticas Psicosociales Y Políticas Públicas",
    "Análisis De La Realidad Y Pensamiento Crítico",
    "Practica Inicial"
  ],
  "Semestre V": [
    "Psicología De La Salud",
    "Psicopatología Y Psiquiatría",
    "Fundamentos De Medición Y Evaluación",
    "Familias Y Contextos Socioculturales",
    "Psicología De La Personalidad Y Diferencias Individuales",
    "Ética Profesional"
  ],
  "Semestre VI": [
    "Intervención En Grupos Y Equipos",
    "Evaluación Psicológica",
    "Diseño Y Evaluación De Intervenciones Psicológicas",
    "Psicología Crítica",
    "Diseños y Análisis en Investigación Metodológica Cuantitativas",
    "Seminarios De Profundización Temática"
  ],
  "Semestre VII": [
    "Introducción A La Psicología Laboral- Organizacional",
    "Introducción A La Psicología Comunitaria",
    "Introducción A La Psicología Educacional",
    "Fundamentos En Psicología Clínica Y Psicoterapia",
    "Diseños y Análisis en Investigación Metodológica Cualitativas",
    "Taller De Desarrollo Personal Y Autogestión Del Aprendizaje: Ejercicio Profesional"
  ],
  "Semestre VIII": [
    "Práctica Formativa: Psicología Laboral- Organizacional",
    "Práctica Formativa: Psicología Comunitaria",
    "E.F.P: Electivo Profundización en Investigación",
    "Socialización Labor"
  ],
  "Semestre IX": [
    "Práctica Formativa: Psicología Educacional",
    "Práctica Formativa: Psicología Clínica, Psicoterapia y Psicología de la Salud",
    "Seminario de Investigación I"
  ],
  "Semestre X": [
    "Actividad de Titulación: Práctica Profesional",
    "Trabajo Final de Grado Sistematización de Experiencias",
    "Seminario de Investigación II"
  ]
};

const state = {};

function toggleCourse(name) {
  const course = state[name];
  if (!course || course.element.classList.contains("blocked")) return;

  course.approved = !course.approved;
  course.element.classList.toggle("approved", course.approved);
  course.element.classList.toggle("not-approved", !course.approved);

  updateLocks();
}

function updateLocks() {
  const sem1to3 = [
    ...semesters["Semestre I"],
    ...semesters["Semestre II"],
    ...semesters["Semestre III"],
  ];

  const allApprovedSem1to3 = sem1to3.every(ramo => state[ramo]?.approved);

  for (const key in courses) {
    const prerequisites = Object.keys(courses).filter(k => courses[k].unlocks?.includes(key));
    let unlocked = prerequisites.every(p => state[p]?.approved);

    if (key === "Practica Inicial") {
      unlocked = allApprovedSem1to3;
    }

    if (state[key]) {
      if (unlocked && !state[key].approved) {
        state[key].element.classList.remove("blocked");
        state[key].element.classList.add("not-approved");
      } else if (!state[key].approved) {
        state[key].element.classList.add("blocked");
        state[key].element.classList.remove("not-approved");
      }
    }
  }
}

function initializeGrid() {
  const container = document.getElementById("semesters");
  container.style.display = "flex";
  container.style.flexDirection = "row";
  container.style.gap = "20px";
  container.style.overflowX = "auto";
  container.style.alignItems = "flex-start";

  for (const [semestre, cursos] of Object.entries(semesters)) {
    const section = document.createElement("section");
    section.style.minWidth = "250px";
    section.style.flex = "0 0 auto";

    const title = document.createElement("h2");
    const grid = document.createElement("div");

    title.textContent = semestre;
    title.style.textAlign = "center";
    grid.className = "grid";

    cursos.forEach(nombre => {
      const div = document.createElement("div");
      div.classList.add("cell", "not-approved");
      div.textContent = nombre.replace(/\s\(I\)|\s\(II\)/g, "");
      div.onclick = () => toggleCourse(nombre);
      grid.appendChild(div);
      state[nombre] = { element: div, approved: false };
    });

    section.appendChild(title);
    section.appendChild(grid);
    container.appendChild(section);
  }

  updateLocks();
}

initializeGrid();
